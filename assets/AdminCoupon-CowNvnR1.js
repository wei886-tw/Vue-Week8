import{A as v}from"./AdminNavBar-BTiC6PRF.js";import{P as y}from"./PageNation-wGer-_bh.js";import{m as M}from"./mixin-CyhdtnIY.js";import{_ as k,l as u,j as e,i as d,F as h,v as w,g as x,k as p,e as m,y as i,G as c,H as r,A as D,I as V}from"./index-Tw73v_m_.js";const $={components:{AdminNavBar:v,PageNation:y},mixins:[M],data(){return{api_path:"wei123",url:"https://vue3-course-api.hexschool.io",title:"",is_enabled:!0,percent:"",due_date:"",code:"",myModal:"",coupons:"",couponPagination:"",date:"",tempCoupon:{}}},methods:{createCoupon(){this.due_date=parseInt(new Date(this.$refs.date.value).getTime()),this.is_enabled===!0?this.is_enabled=1:this.is_enabled=0,this.$http.post(`${this.url}/v2/api/${this.api_path}/admin/coupon`,{data:{title:this.title,is_enabled:this.is_enabled,percent:this.percent,due_date:this.due_date,code:this.code}}).then(()=>{alert("建立優惠券成功"),this.$refs.form.reset(),this.myModal.hide(),this.getCoupons(1)}).catch(a=>{console.log(a.response.data.message)})},openModal(a){this.myModal.show(),this.$http.get(`${this.url}/v2/api/${this.api_path}/admin/coupons/${a}`).then(()=>{console.log(123)}).catch(t=>{console.log(t.response.data.message)})},closeModal(){this.myModal.hide()},getCoupons(a){this.$http.get(`${this.url}/v2/api/${this.api_path}/admin/coupons?page=${a}`).then(t=>{this.coupons=t.data.coupons,this.couponPagination=t.data.pagination}).catch(t=>{console.log(t.response.data.message)})},adviseCoupon(a){this.tempCoupon={...a},this.tempCoupon.is_enabled=this.tempCoupon.is_enabled?"true":"false",this.tempCoupon.due_date="new Date(this.tempCoupon.due_date * 1000).getDate()/new Date(this.tempCoupon.due_date * 1000).getMonth()/new Date(this.tempCoupon.due_date * 1000).getYear() ",console.log(this.tempCoupon.due_date),this.$http.put(`${this.url}/v2/api/${this.api_path}/admin/coupon/${this.tempCoupon.id}`,{data:{title:this.tempCoupon.title,is_enabled:this.tempCoupon.is_enabled,percent:this.tempCoupon.percent,due_date:this.tempCoupon.due_date}}).then(()=>{this.myModal.show()}).catch(t=>{console.log(t.response.data.message)})},deleteCoupon(a){this.$http.delete(`${this.url}/v2/api/${this.api_path}/admin/coupon/${a}`).then(()=>{alert("已刪除優惠券"),this.getCoupons(1)})}},mounted(){this.myModal=new bootstrap.Modal(this.$refs.couponModal),this.loadingCircle(),this.getCoupons(1)}},P={class:"container-fluid px-0"},U={class:"container-fluid px-0"},A={class:"container py-48"},B={class:"container mb-24 d-flex justify-content-between px-0"},N=e("h2",{class:"fs-32 fw-bold"},"優惠券管理",-1),j={class:"table mb-16"},F=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券標題"),e("th",{scope:"col"},"折價"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"修改"),e("th",{scope:"col"},"刪除")])],-1),I=["onClick"],T=["onClick"],Y={class:"container"},q={class:"modal",tabindex:"-1",ref:"couponModal"},z={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},E={class:"modal-content"},G=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"建立優惠券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},L={class:"form-group mb-16"},S=e("label",{for:"title",class:"form-label"},"優惠券名稱",-1),J={class:"form-group mb-16"},K=e("label",{for:"percent",class:"form-label"},"折扣",-1),O={class:"form-group mb-16"},Q=e("label",{for:"due_date",class:"form-label"},"到期日",-1),R={class:"form-group mb-16"},W=e("label",{for:"code",class:"form-label"},"優惠券代碼",-1),X={class:"form-check form-switch mb-16"},Z=e("label",{for:"is_enabled",class:"form-check-label"},"是否啟用優惠券",-1),ee={class:"modal-footer"},te={class:"container"};function oe(a,t,se,ne,s,l){const _=p("admin-nav-bar"),b=p("page-nation"),f=p("error-message"),g=p("v-form"),C=p("router-view");return m(),u(h,null,[e("div",P,[d(_)]),e("div",U,[e("div",A,[e("div",B,[N,e("button",{type:"button",class:"btn btn-dark",onClick:t[0]||(t[0]=(...o)=>l.openModal&&l.openModal(...o))}," 建立優惠券 ")]),e("table",j,[F,e("tbody",null,[(m(!0),u(h,null,w(s.coupons,o=>(m(),u("tr",{key:o.id},[e("td",null,i(o.title),1),e("td",null,i(o.percent)+" 折",1),e("td",null,i(new Date(o.due_date).getFullYear())+"/ "+i(new Date(o.due_date).getMonth())+"/ "+i(new Date(o.due_date).getDate()),1),e("td",null,i(o.is_enabled?"是":"否"),1),e("td",null,[e("button",{class:"btn btn-success",onClick:n=>l.adviseCoupon(o)}," 修改優惠券 ",8,I)]),e("td",null,[e("button",{class:"btn btn-danger",onClick:n=>l.deleteCoupon(o.id)}," 刪除優惠券 ",8,T)])]))),128))])]),e("div",Y,[d(b,{pagination:s.couponPagination,"get-page-products":l.getCoupons,class:"d-flex justify-content-end"},null,8,["pagination","get-page-products"])])])]),e("div",q,[e("div",z,[e("div",E,[G,e("div",H,[d(g,{action:"",ref:"form"},{default:x(({errors:o})=>[e("div",L,[S,c(e("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=n=>s.tempCoupon.title=n),type:"text",class:D(["form-control",{"is-invalid":o.優惠券名稱}]),placeholder:"請輸入優惠券名稱",rules:"required",name:"優惠券名稱"},null,2),[[r,s.tempCoupon.title]]),d(f,{name:"優惠券名稱",class:"invalid-feedback"})]),e("div",J,[K,c(e("input",{id:"percent","onUpdate:modelValue":t[2]||(t[2]=n=>s.tempCoupon.percent=n),type:"number",class:"form-control",placeholder:"請輸入折扣"},null,512),[[r,s.tempCoupon.percent]])]),e("div",O,[Q,c(e("input",{id:"due_date","onUpdate:modelValue":t[3]||(t[3]=n=>s.tempCoupon.date=n),type:"date",class:"form-control",placeholder:"請輸入到期日",ref:"date"},null,512),[[r,s.tempCoupon.date]])]),e("div",R,[W,c(e("input",{id:"code","onUpdate:modelValue":t[4]||(t[4]=n=>s.tempCoupon.code=n),type:"text",class:"form-control",placeholder:"請輸入優惠券代碼"},null,512),[[r,s.tempCoupon.code]])]),e("div",X,[Z,c(e("input",{id:"is_enabled","onUpdate:modelValue":t[5]||(t[5]=n=>s.tempCoupon.is_enabled=n),type:"checkbox",class:"form-check-input"},null,512),[[V,s.tempCoupon.is_enabled]])])]),_:1},512)]),e("div",ee,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[6]||(t[6]=(...o)=>l.closeModal&&l.closeModal(...o))}," 關閉 "),e("button",{type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...o)=>l.createCoupon&&l.createCoupon(...o))}," 建立優惠券 ")])])])],512),e("div",te,[d(C)])],64)}const pe=k($,[["render",oe]]);export{pe as default};
