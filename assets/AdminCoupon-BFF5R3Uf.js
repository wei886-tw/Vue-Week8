import{A as v}from"./AdminNavBar-B8bZa9eS.js";import{P as y}from"./PageNation-Dt6m0ABa.js";import{m as k}from"./mixin-CE07gU2g.js";import{_ as M,l as d,j as e,i as p,F as h,v as x,g as w,k as c,e as r,y as l,G as u,H as m,A as D,I as V}from"./index-5y_Diymh.js";const N={components:{AdminNavBar:v,PageNation:y},mixins:[k],data(){return{api_path:"wei123",url:"https://vue3-course-api.hexschool.io",title:"",is_enabled:!0,percent:"",due_date:"",code:"",myModal:"",coupons:"",couponPagination:"",date:"",tempCoupon:{},original_due_date:""}},methods:{createCoupon(){this.due_date=parseInt(new Date(this.$refs.date.value).getTime()),this.is_enabled===!0?this.is_enabled=1:this.is_enabled=0,this.$http.post(`${this.url}/v2/api/${this.api_path}/admin/coupon`,{data:{title:this.title,is_enabled:this.is_enabled,percent:this.percent,due_date:this.due_date,code:this.code}}).then(()=>{alert("建立優惠券成功"),this.$refs.form.reset(),this.myModal.hide(),this.getCoupons(1)}).catch(s=>{console.log(s.response.data.message)})},openModal(s){s!==""?(this.tempCoupon={...s},this.tempCoupon.is_enabled=this.tempCoupon.is_enabled?"true":"false",this.original_due_date=this.tempCoupon.due_date,this.tempCoupon.due_date=new Date(this.tempCoupon.due_date).toISOString().split("T")[0]):this.tempCoupon={},this.myModal.show()},closeModal(){this.myModal.hide()},getCoupons(s){this.$http.get(`${this.url}/v2/api/${this.api_path}/admin/coupons?page=${s}`).then(t=>{this.coupons=t.data.coupons,this.couponPagination=t.data.pagination}).catch(t=>{console.log(t.response.data.message)})},adviseCoupon(){this.tempCoupon.is_enabled===!0?this.tempCoupon.is_enabled=1:this.tempCoupon.is_enabled=0,this.tempCoupon.id?this.$http.put(`${this.url}/v2/api/${this.api_path}/admin/coupon/${this.tempCoupon.id}`,{data:{title:this.tempCoupon.title,is_enabled:this.tempCoupon.is_enabled,percent:parseInt(this.tempCoupon.percent),due_date:Number(Date.parse(this.tempCoupon.due_date)),code:this.tempCoupon.code}}).then(()=>{alert("修改優惠券成功"),this.myModal.hide(),this.getCoupons(),this.loadingCircle()}).catch(s=>{console.log(s.response.data.message)}):(this.tempCoupon.due_date=Date.parse(this.tempCoupon.due_date),this.$http.post(`${this.url}/v2/api/${this.api_path}/admin/coupon`,{data:{title:this.tempCoupon.title,is_enabled:this.tempCoupon.is_enabled,percent:this.tempCoupon.percent,due_date:this.tempCoupon.due_date,code:this.tempCoupon.code}}).then(()=>{alert("優惠券建立成功"),this.myModal.hide(),this.getCoupons(),this.loadingCircle()}).catch(s=>{console.log(s.response.data.message)}))},deleteCoupon(s){this.$http.delete(`${this.url}/v2/api/${this.api_path}/admin/coupon/${s}`).then(()=>{alert("已刪除優惠券"),this.getCoupons(1)})}},mounted(){this.myModal=new bootstrap.Modal(this.$refs.couponModal),this.loadingCircle(),this.getCoupons(1)}},P={class:"container-fluid px-0"},S={class:"container-fluid px-0"},U={class:"container py-48"},$={class:"container mb-24 d-flex justify-content-between px-0"},A=e("h2",{class:"fs-32 fw-bold"},"優惠券管理",-1),B={class:"table mb-16"},I=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券標題"),e("th",{scope:"col"},"折價"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"修改"),e("th",{scope:"col"},"刪除")])],-1),j=["onClick"],F=["onClick"],T={class:"container"},q={class:"modal",tabindex:"-1",ref:"couponModal"},z={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},E={class:"modal-content"},G=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"建立優惠券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},L={class:"form-group mb-16"},O=e("label",{for:"title",class:"form-label"},"優惠券名稱",-1),Y={class:"form-group mb-16"},J=e("label",{for:"percent",class:"form-label"},"折扣",-1),K={class:"form-group mb-16"},Q=e("label",{for:"due_date",class:"form-label"},"到期日",-1),R={class:"form-group mb-16"},W=e("label",{for:"code",class:"form-label"},"優惠券代碼",-1),X={class:"form-check form-switch mb-16"},Z=e("label",{for:"is_enabled",class:"form-check-label"},"是否啟用優惠券",-1),ee={class:"modal-footer"},te={class:"container"};function oe(s,t,se,ne,n,i){const _=c("admin-nav-bar"),b=c("page-nation"),C=c("error-message"),f=c("v-form"),g=c("router-view");return r(),d(h,null,[e("div",P,[p(_)]),e("div",S,[e("div",U,[e("div",$,[A,e("button",{type:"button",class:"btn btn-dark",onClick:t[0]||(t[0]=o=>i.openModal(""))}," 建立優惠券 ")]),e("table",B,[I,e("tbody",null,[(r(!0),d(h,null,x(n.coupons,o=>(r(),d("tr",{key:o.id},[e("td",null,l(o.title),1),e("td",null,l(o.percent)+" %",1),e("td",null,l(new Date(o.due_date).getFullYear())+"/ "+l(String(new Date(o.due_date).getMonth()+1).padStart(2,"0"))+"/ "+l(new Date(o.due_date).getDate()),1),e("td",null,l(o.is_enabled?"是":"否"),1),e("td",null,[e("button",{class:"btn btn-success",onClick:a=>i.openModal(o)}," 修改優惠券 ",8,j)]),e("td",null,[e("button",{class:"btn btn-danger",onClick:a=>i.deleteCoupon(o.id)}," 刪除優惠券 ",8,F)])]))),128))])]),e("div",T,[p(b,{pagination:n.couponPagination,"get-page-products":i.getCoupons,class:"d-flex justify-content-end"},null,8,["pagination","get-page-products"])])])]),e("div",q,[e("div",z,[e("div",E,[G,e("div",H,[p(f,{action:"",ref:"form"},{default:w(({errors:o})=>[e("div",L,[O,u(e("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=a=>n.tempCoupon.title=a),type:"text",class:D(["form-control",{"is-invalid":o.優惠券名稱}]),placeholder:"請輸入優惠券名稱",rules:"required",name:"優惠券名稱"},null,2),[[m,n.tempCoupon.title]]),p(C,{name:"優惠券名稱",class:"invalid-feedback"})]),e("div",Y,[J,u(e("input",{id:"percent","onUpdate:modelValue":t[2]||(t[2]=a=>n.tempCoupon.percent=a),type:"number",class:"form-control",placeholder:"請輸入折扣"},null,512),[[m,n.tempCoupon.percent]])]),e("div",K,[Q,u(e("input",{id:"due_date","onUpdate:modelValue":t[3]||(t[3]=a=>n.tempCoupon.due_date=a),value:"",type:"date",class:"form-control",placeholder:"請輸入到期日",ref:"date"},null,512),[[m,n.tempCoupon.due_date]])]),e("div",R,[W,u(e("input",{id:"code","onUpdate:modelValue":t[4]||(t[4]=a=>n.tempCoupon.code=a),type:"text",class:"form-control",placeholder:"請輸入優惠券代碼"},null,512),[[m,n.tempCoupon.code]])]),e("div",X,[Z,u(e("input",{id:"is_enabled","onUpdate:modelValue":t[5]||(t[5]=a=>n.tempCoupon.is_enabled=a),type:"checkbox",class:"form-check-input"},null,512),[[V,n.tempCoupon.is_enabled]])])]),_:1},512)]),e("div",ee,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[6]||(t[6]=(...o)=>i.closeModal&&i.closeModal(...o))}," 關閉 "),n.tempCoupon.id?(r(),d("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...o)=>i.adviseCoupon&&i.adviseCoupon(...o))}," 修改優惠券 ")):(r(),d("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...o)=>i.createCoupon&&i.createCoupon(...o))}," 建立優惠券 "))])])])],512),e("div",te,[p(g)])],64)}const pe=M(N,[["render",oe]]);export{pe as default};
//# sourceMappingURL=AdminCoupon-BFF5R3Uf.js.map
