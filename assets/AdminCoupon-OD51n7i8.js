import{A as k}from"./AdminNavBar-Bpljs9oj.js";import{P as M}from"./PageNation-c2j5QEL8.js";import{m as x}from"./mixin-CyhdtnIY.js";import{_ as w,l as d,j as e,i as p,F as b,v as D,g as V,k as c,e as r,y as i,G as u,H as m,A as I,I as P}from"./index-BvCc1PIM.js";const U={components:{AdminNavBar:k,PageNation:M},mixins:[x],data(){return{api_path:"wei123",url:"https://vue3-course-api.hexschool.io",title:"",is_enabled:!0,percent:"",due_date:"",code:"",myModal:"",coupons:"",couponPagination:"",date:"",tempCoupon:{},original_due_date:""}},methods:{createCoupon(){this.due_date=parseInt(new Date(this.$refs.date.value).getTime()),this.is_enabled===!0?this.is_enabled=1:this.is_enabled=0,this.$http.post(`${this.url}/v2/api/${this.api_path}/admin/coupon`,{data:{title:this.title,is_enabled:this.is_enabled,percent:this.percent,due_date:this.due_date,code:this.code}}).then(()=>{alert("建立優惠券成功"),this.$refs.form.reset(),this.myModal.hide(),this.getCoupons(1)}).catch(l=>{console.log(l.response.data.message)})},openModal(l){this.tempCoupon={...l},this.tempCoupon.is_enabled=this.tempCoupon.is_enabled?"true":"false",this.original_due_date=this.tempCoupon.due_date;const t=parseInt(new Date(this.tempCoupon.due_date).getMonth()),h=parseInt(new Date(this.tempCoupon.due_date).getDate()),_=parseInt(new Date(this.tempCoupon.due_date).getFullYear());this.tempCoupon.due_date=this.due_date=`${t}/${h}/${_}`,this.myModal.show()},closeModal(){this.myModal.hide()},getCoupons(l){this.$http.get(`${this.url}/v2/api/${this.api_path}/admin/coupons?page=${l}`).then(t=>{this.coupons=t.data.coupons,this.couponPagination=t.data.pagination}).catch(t=>{console.log(t.response.data.message)})},adviseCoupon(){console.log(this.tempCoupon.due_date),this.tempCoupon.is_enabled===!0?this.tempCoupon.is_enabled=1:this.tempCoupon.is_enabled=0,this.$http.put(`${this.url}/v2/api/${this.api_path}/admin/coupon/${this.tempCoupon.id}`,{data:{title:this.tempCoupon.title,is_enabled:this.tempCoupon.is_enabled,percent:parseInt(this.tempCoupon.percent),due_date:this.original_due_dat}}).then(()=>{alert("修改優惠券成功"),this.myModal.hide(),this.getCoupons(),this.loadingCircle()}).catch(l=>{console.log(l.response.data.message)})},deleteCoupon(l){this.$http.delete(`${this.url}/v2/api/${this.api_path}/admin/coupon/${l}`).then(()=>{alert("已刪除優惠券"),this.getCoupons(1)})}},mounted(){this.myModal=new bootstrap.Modal(this.$refs.couponModal),this.loadingCircle(),this.getCoupons(1)}},A={class:"container-fluid px-0"},B={class:"container-fluid px-0"},F={class:"container py-48"},N={class:"container mb-24 d-flex justify-content-between px-0"},j=e("h2",{class:"fs-32 fw-bold"},"優惠券管理",-1),$={class:"table mb-16"},T=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券標題"),e("th",{scope:"col"},"折價"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"修改"),e("th",{scope:"col"},"刪除")])],-1),Y=["onClick"],q=["onClick"],z={class:"container"},E={class:"modal",tabindex:"-1",ref:"couponModal"},G={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},H={class:"modal-content"},L=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"建立優惠券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),S={class:"modal-body"},J={class:"form-group mb-16"},K=e("label",{for:"title",class:"form-label"},"優惠券名稱",-1),O={class:"form-group mb-16"},Q=e("label",{for:"percent",class:"form-label"},"折扣",-1),R={class:"form-group mb-16"},W=e("label",{for:"due_date",class:"form-label"},"到期日",-1),X={class:"form-group mb-16"},Z=e("label",{for:"code",class:"form-label"},"優惠券代碼",-1),ee={class:"form-check form-switch mb-16"},te=e("label",{for:"is_enabled",class:"form-check-label"},"是否啟用優惠券",-1),oe={class:"modal-footer"},se={class:"container"};function ne(l,t,h,_,s,n){const C=c("admin-nav-bar"),f=c("page-nation"),g=c("error-message"),v=c("v-form"),y=c("router-view");return r(),d(b,null,[e("div",A,[p(C)]),e("div",B,[e("div",F,[e("div",N,[j,e("button",{type:"button",class:"btn btn-dark",onClick:t[0]||(t[0]=(...o)=>n.openModal&&n.openModal(...o))}," 建立優惠券 ")]),e("table",$,[T,e("tbody",null,[(r(!0),d(b,null,D(s.coupons,o=>(r(),d("tr",{key:o.id},[e("td",null,i(o.title),1),e("td",null,i(o.percent)+" 折",1),e("td",null,i(new Date(o.due_date).getFullYear())+"/ "+i(new Date(o.due_date).getMonth())+"/ "+i(new Date(o.due_date).getDate()),1),e("td",null,i(o.is_enabled?"是":"否"),1),e("td",null,[e("button",{class:"btn btn-success",onClick:a=>n.openModal(o)}," 修改優惠券 ",8,Y)]),e("td",null,[e("button",{class:"btn btn-danger",onClick:a=>n.deleteCoupon(o.id)}," 刪除優惠券 ",8,q)])]))),128))])]),e("div",z,[p(f,{pagination:s.couponPagination,"get-page-products":n.getCoupons,class:"d-flex justify-content-end"},null,8,["pagination","get-page-products"])])])]),e("div",E,[e("div",G,[e("div",H,[L,e("div",S,[p(v,{action:"",ref:"form"},{default:V(({errors:o})=>[e("div",J,[K,u(e("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=a=>s.tempCoupon.title=a),type:"text",class:I(["form-control",{"is-invalid":o.優惠券名稱}]),placeholder:"請輸入優惠券名稱",rules:"required",name:"優惠券名稱"},null,2),[[m,s.tempCoupon.title]]),p(g,{name:"優惠券名稱",class:"invalid-feedback"})]),e("div",O,[Q,u(e("input",{id:"percent","onUpdate:modelValue":t[2]||(t[2]=a=>s.tempCoupon.percent=a),type:"number",class:"form-control",placeholder:"請輸入折扣"},null,512),[[m,s.tempCoupon.percent]])]),e("div",R,[W,u(e("input",{id:"due_date","onUpdate:modelValue":t[3]||(t[3]=a=>s.tempCoupon.due_date=a),type:"text",class:"form-control",placeholder:"請輸入到期日",ref:"date"},null,512),[[m,s.tempCoupon.due_date]])]),e("div",X,[Z,u(e("input",{id:"code","onUpdate:modelValue":t[4]||(t[4]=a=>s.tempCoupon.code=a),type:"text",class:"form-control",placeholder:"請輸入優惠券代碼"},null,512),[[m,s.tempCoupon.code]])]),e("div",ee,[te,u(e("input",{id:"is_enabled","onUpdate:modelValue":t[5]||(t[5]=a=>s.tempCoupon.is_enabled=a),type:"checkbox",class:"form-check-input"},null,512),[[P,s.tempCoupon.is_enabled]])])]),_:1},512)]),e("div",oe,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[6]||(t[6]=(...o)=>n.closeModal&&n.closeModal(...o))}," 關閉 "),s.tempCoupon?(r(),d("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...o)=>n.adviseCoupon&&n.adviseCoupon(...o))}," 修改優惠券 ")):(r(),d("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...o)=>n.createCoupon&&n.createCoupon(...o))}," 建立優惠券 "))])])])],512),e("div",se,[p(y)])],64)}const pe=w(U,[["render",ne]]);export{pe as default};
